<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Trip Details</title>
</head>
<body>
    <div th:replace="~{header}"></div>

    <h1>Trip Details</h1>
    <div class="card">
        <div class="card-body">
            <h5 class="card-title" th:text="${trip.tripName}"></h5>
            <p class="card-text">
                <strong>Destination:</strong> <span th:text="${trip.destination}"></span><br>
                <strong>Date:</strong> 
                <span th:text="${#dates.format(trip.startDate, 'yyyy-MM-dd')}"></span> to 
                <span th:text="${#dates.format(trip.endDate, 'yyyy-MM-dd')}"></span>
                <strong th:if="${!isBudgetEmpty}">Total Budget: <span th:text="${trip.budget.totalBudget}"></span></strong>
                <strong th:if="${!isBudgetEmpty}">Remaining Budget: <span th:text="${trip.budget.remainingBudget}"></span></strong>
            </p>

            

            <a th:if="${isPackingListEmpty}" th:href="@{/packing/form(tripId=${trip.id})}" 
                class="btn btn-outline-secondary">Add Packing List
            </a>

            <a th:if="${isBudgetEmpty}" th:href="@{/budget/form(tripId=${trip.id})}" 
                class="btn btn-outline-success">Add Budget
            </a>

        </div>
    </div>

    <!-- Collapsible Packing List -->
    <div th:if="${!isPackingListEmpty}" class="card mt-3">
        <div class="card-header d-flex justify-content-between align-items-center" data-toggle="collapse" href="#packingCollapse">
            <h5 class="mb-0">Packing List</h5>
            <a class="btn btn-outline-secondary btn-sm" th:href="@{/packing/form(tripId=${trip.id})}">
                <i class="fas fa-plus me-1"></i> Add More Items
            </a>
        </div>
        <div id="packingCollapse" class="collapse show">
            <div class="card-body">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Quantity</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="item : ${trip.packingList.packingItems}">
                            <td th:text="${item.itemName}" th:class="${item.packed} ? 'text-muted text-decoration-line-through' : ''"></td>
                            <td th:text="${item.quantity}" th:class="${item.packed} ? 'text-muted text-decoration-line-through' : ''"></td>
                            <td>
                                <!-- Edit Icon -->
                                <a th:href="@{/packing/edit/{id}(id=${item.id})}" 
                                   class="text-primary me-2" 
                                   title="Edit">
                                    <i class="fa-regular fa-pen-to-square"></i>
                                </a>
                                
                                <!-- Delete Icon -->
                                <form th:action="@{/packing/delete/{id}(id=${item.id})}" 
                                      method="post" 
                                      class="d-inline">
                                    <button type="submit" 
                                            class="btn btn-link text-danger p-0" 
                                            title="Delete">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </form>
    
                                <!-- Mark as Packed Icon -->
                                <form th:action="@{/packing/toggle-packed/{id}(id=${item.id})}" 
                                      method="post" 
                                      class="d-inline ms-2">
                                    <button type="submit" 
                                            class="btn btn-link p-0" 
                                            th:classappend="${item.packed} ? 'text-success' : 'text-secondary'"
                                            th:title="${item.packed} ? 'Mark as Unpacked' : 'Mark as Packed'">
                                        <i th:class="${item.packed} ? 'fas fa-check-circle' : 'far fa-circle'"></i>
                                    </button>
                                </form>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div th:replace="~{footer}"></div>
</body>
</html>